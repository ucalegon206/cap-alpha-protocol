# Data Structure & Schema Guide

# Data Structure & Schema Guide (v2.0)

## End-to-End Data Flow

The pipeline follows a "Medallion Architecture" ensuring traceability from raw scrape to strategic output.

```
┌─────────────────────────┐      ┌─────────────────────────┐      ┌─────────────────────────┐
│       BRONZE (Raw)      │      │     SILVER (Deduped)    │      │    GOLD (Intelligence)  │
│      (Local CSVs)       │─────▶│        (DuckDB)         │─────▶│        (DuckDB)         │
│   data/raw/spotrac/*    │      │  silver_spotrac_...     │      │  fact_player_efficiency │
│   data/raw/pfr/*        │      │  silver_pfr_...         │      │                         │
└─────────────────────────┘      └─────────────────────────┘      └────────────┬────────────┘
                                                                               │
                                                                               ▼
                                                                  ┌─────────────────────────┐
                                                                  │  PLATINUM (Reporting)   │
                                                                  │       (Markdown)        │
                                                                  │  Strategic Audit 2025   │
                                                                  │  Risk Intelligence      │
                                                                  └─────────────────────────┘
```

## Schema Reference

### 1. Silver Layer (Cleaned Source)
Normalized tables ingested from raw CSVs.

- **`silver_spotrac_contracts`**
    - `player_name`, `team`, `position`, `year`, `cap_hit_millions`, `dead_cap_millions`, `contract_terms`...
    - *Source*: `data/raw/spotrac_player_contracts_YYYY.csv`
- **`silver_pfr_game_logs`**
    - `player_name`, `date`, `opponent`, `pass_yds`, `rush_yds`, `rec_yds`, `fantasy_points`...
    - *Source*: `data/raw/pfr/game_logs/`
- **`silver_pfr_draft_history`**
    - `player_name`, `team`, `position`, `round`, `pick`, `year`
    - *Source*: `data/raw/pfr/draft_history.csv`

### 2. Gold Layer (Modeling Ready)
Aggregated "One Big Table" for modeling and analysis.

- **`fact_player_efficiency`**
    - **Identifiers**: `player_name`, `team`, `position`, `year`
    - **Financials**: `cap_hit_millions`, `dead_cap_millions`, `guaranteed_money`
    - **Performance**: `total_tds`, `total_yards`, `games_played`
    - **Calculated**: 
        - `value_metric_proxy`: Efficiency per dollar.
        - `edce_risk`: Expected Dead Cap Exposure (Target Variable).

### 3. Platinum Outputs (Strategic Engine)
Outputs generated by `src/strategic_engine.py`.

- **Risk Frontier**:
    - `avg_risk`: 0-1 probability of Toxic Dead Money.
    - `avg_efficiency`: Performance efficiency relative to cap hit.
- **Prescriptions**:
    - `strategic_prescription`: "Emergency Purge", "Selective Optimization", etc.
    - `draft_priority`: Tactical draft advice (e.g., "Develop Successor: Penix").

## File Locations

- **Database**: `data/nfl_data.db` (DuckDB Persistent Store)
- **Raw Data**: `data/raw/{source}/{filename}.csv`
- **Reports**: `reports/nfl_team_strategic_audit_2025.md`
